{% extends "base.html" %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-secondary"><i class="fa-solid fa-users-gear"></i> Gestión de Condóminos</h2>
    
    <form action="{{ url_for('condominos.generar_mensualidad') }}" method="POST" onsubmit="return confirm('¿Deseas generar los cargos de expensas para todos los departamentos este mes?');">
        <button type="submit" class="btn btn-warning shadow-sm">
            <i class="fa-solid fa-file-invoice-dollar"></i> Generar Expensas del Mes
        </button>
    </form>
</div>

<div class="row row-cols-1 row-cols-lg-2 g-4">
    {% for d in departamentos %}
    <div class="col">
        <div class="card h-100 shadow-sm border-0 border-start border-4 {% if d.esta_arrendado %}border-warning{% else %}border-info{% endif %}">
            <div class="card-body">
                <div class="row">
                    <div class="col-sm-4 text-center border-end">
                        <h1 class="display-4 fw-bold text-primary mb-0">{{ d.numero }}</h1>
                        <span class="badge bg-light text-dark border">Piso {{ d.piso }}</span>
                        <div class="mt-3">
                             {% if d.esta_arrendado %}
                                <span class="text-warning small fw-bold"><i class="fa-solid fa-key"></i> ARRENDADO</span>
                            {% else %}
                                <span class="text-info small fw-bold"><i class="fa-solid fa-house-user"></i> HABITADO</span>
                            {% endif %}
                        </div>
                    </div>

                    <div class="col-sm-8 ps-lg-4">
                        <div class="mb-2">
                            <small class="text-muted text-uppercase d-block">Propietario</small>
                            <h5 class="fw-bold mb-0">
                                {# Buscamos al propietario entre los contactos #}
                                {% set propietario = d.personas|selectattr("rol", "equalto", "PROPIETARIO")|first %}
                                {{ propietario.nombre if propietario else "Sin asignar" }}
                            </h5>
                        </div>

                        <div class="row mb-3">
                            <div class="col-4">
                                <small class="text-muted d-block">Expensa Fija</small>
                                <span class="fw-bold fs-5 text-success">${{ "%.2f"|format(d.valor_expensa) }}</span>
                            </div>
                            <div class="col-3">
                                <small class="text-muted d-block">Alícuota</small>
                                <span class="fw-bold">{{ "%.2f"|format(d.alicuota) }}%</span>
                            </div>
                            <div class="col-5">
                                <small class="text-muted d-block">Paga</small>
                                <span class="fw-bold">{{ d.responsable_pago }}</span>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center bg-light p-2 rounded">
                            <a href="{{ url_for('condominos.estado_cuenta', id=d.id) }}" class="btn btn-outline-dark btn-sm shadow-sm">
                                <i class="fa-solid fa-list-check"></i> Estado de Cuenta
                            </a>
                            <a href="{{ url_for('condominos.editar_departamento', id=d.id) }}" class="btn btn-primary btn-sm shadow-sm">
                                <i class="fa-solid fa-user-pen"></i> Editar Info
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
    .hover-effect:hover {
        transform: translateY(-5px);
        transition: 0.3s;
    }
</style>
{% endblock %}